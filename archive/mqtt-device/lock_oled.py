from machine import Pin, I2C
import ssd1306
import framebuf

led = Pin(2, Pin.OUT)

i2c = I2C(sda=Pin(4), scl=Pin(5))
display = ssd1306.SSD1306_I2C(64, 48, i2c)

lock_closed = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xf0\x00\x00\x00\x00\x00\x00\x7f\xfe\x00\x00\x00\x00\x00\x00\xff\xff\x00\x00\x00\x00\x00\x03\xf8\x1f\xc0\x00\x00\x00\x00\x07\xe0\x07\xe0\x00\x00\x00\x00\x07\x80\x01\xe0\x00\x00\x00\x00\x0f\x00\x00\xf0\x00\x00\x00\x00\x1e\x00\x00\x78\x00\x00\x00\x00\x1c\x00\x00\x38\x00\x00\x00\x00\x1c\x00\x00\x38\x00\x00\x00\x00\x3c\x00\x00\x3c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xff\xff\xff\xff\xe0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xfc\x3f\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x0f\xff\xff\xff\xff\xf0\x00\x00\x07\xff\xff\xff\xff\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')
lock_open = bytearray(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xf0\x00\x00\x00\x00\x00\x00\x7f\xfe\x00\x00\x00\x00\x00\x00\xff\xff\x00\x00\x00\x00\x00\x03\xf8\x1f\xc0\x00\x00\x00\x00\x07\xe0\x07\xe0\x00\x00\x00\x00\x07\x80\x01\xe0\x00\x00\x00\x00\x0f\x00\x00\xf0\x00\x00\x00\x00\x1e\x00\x00\x78\x00\x00\x00\x00\x1c\x00\x00\x38\x00\x00\x00\x00\x1c\x00\x00\x38\x00\x00\x00\x00\x3c\x00\x00\x3c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x38\x00\x00\x1c\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\xff\xff\xff\xf0\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xfe\x1f\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x07\xff\xff\xff\xff\xf8\x00\x00\x03\xff\xff\xff\xff\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00')


lockclosed_fb = framebuf.FrameBuffer(lock_closed, 64, 48, framebuf.MONO_HLSB)
lockopen_fb = framebuf.FrameBuffer(lock_open, 64, 48, framebuf.MONO_HLSB)

state = "close"

def getLockState():
    global state
    return state

def setLockState(newstate):
    global state
    state = newstate
    print("updated state: "+state)
    if(state == "open"):
        led.value(0)
        display.fill(0)
        display.blit(lockopen_fb, 0, 0)
        display.show()
    elif(state == "close"):
        led.value(1)
        display.fill(0)
        display.blit(lockclosed_fb, 0, 0)
        display.show()

setLockState("close")